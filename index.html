<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flashcard Hub</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #fce4ec);
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
    }
    .auth, .main, .subject-view {
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px;
    }
    .subject, .flashcard {
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      color: #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }
    .subject-btns, .flashcard-btns {
      display: flex;
      gap: 8px;
    }
    .hidden {
      display: none;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .btn-primary {
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
    }
  </style>
</head>
<body>

  <h1>üìö Flashcard Hub</h1>

  <div class="auth" id="auth">
    <div class="top-bar">
      <h2 id="formTitle">Sign In</h2>
      <div>
        <button onclick="showForm('signin')" class="btn-primary">Sign In</button>
        <button onclick="showForm('signup')" class="btn-primary">Sign Up</button>
      </div>
    </div>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="handleAuth()" class="btn-primary">Submit</button>
    <p id="authMsg" style="color:red;"></p>
  </div>

  <div class="main hidden" id="main">
    <h2>Subjects</h2>
    <button onclick="addSubject()" class="btn-primary">‚ûï Add Subject</button>
    <div id="subjectList"></div>
  </div>

  <div class="subject-view hidden" id="subjectView">
    <h2 id="subjectTitle"></h2>
    <button onclick="addFlashcard()" class="btn-primary">‚ûï Add Flashcard</button>
    <button onclick="shuffleFlashcards()" class="btn-primary">üîÄ Shuffle</button>
    <button onclick="goBack()" class="btn-primary">‚¨Ö Back</button>
    <div id="flashcardList"></div>
  </div>

  <script>
    let currentUser = null;
    let currentSubject = null;
    const colors = ["#e1f5fe", "#fce4ec", "#e8f5e9", "#f3e5f5", "#fff3e0", "#ede7f6", "#e0f2f1", "#fffde7"];
    let usedColors = [];

    function showForm(type) {
      document.getElementById('formTitle').innerText = type === 'signup' ? 'Sign Up' : 'Sign In';
      document.getElementById('authMsg').innerText = '';
    }

    function handleAuth() {
      const uname = document.getElementById("username").value.trim();
      const pword = document.getElementById("password").value.trim();
      const title = document.getElementById("formTitle").innerText;
      let users = JSON.parse(localStorage.getItem("users") || "{}");

      if (!uname || !pword) {
        return alert("Please fill in all fields.");
      }

      if (title === "Sign Up") {
        if (users[uname]) {
          document.getElementById("authMsg").innerText = "User already exists!";
          return;
        }
        users[uname] = { password: pword, subjects: {} };
        localStorage.setItem("users", JSON.stringify(users));
      } else {
        if (!users[uname] || users[uname].password !== pword) {
          document.getElementById("authMsg").innerText = "Invalid username or password!";
          return;
        }
      }

      currentUser = uname;
      document.getElementById("auth").classList.add("hidden");
      document.getElementById("main").classList.remove("hidden");
      loadSubjects();
    }

    function getUserData() {
      let users = JSON.parse(localStorage.getItem("users") || "{}");
      return users[currentUser];
    }

    function updateUserData(data) {
      let users = JSON.parse(localStorage.getItem("users") || "{}");
      users[currentUser] = data;
      localStorage.setItem("users", JSON.stringify(users));
    }

    function getUniqueColor() {
      if (usedColors.length >= colors.length) usedColors = [];
      const available = colors.filter(c => !usedColors.includes(c));
      const color = available[Math.floor(Math.random() * available.length)];
      usedColors.push(color);
      return color;
    }

    function loadSubjects() {
      const user = getUserData();
      const container = document.getElementById("subjectList");
      container.innerHTML = "";
      for (let sub in user.subjects) {
        const div = document.createElement("div");
        div.className = "subject";
        div.style.background = getUniqueColor();
        div.innerHTML = `
          <span onclick="enterSubject('${sub}')">${sub}</span>
          <div class="subject-btns">
            <button class="icon-btn" onclick="renameSubject('${sub}')">üñäÔ∏è</button>
            <button class="icon-btn" onclick="deleteSubject('${sub}')">‚úñÔ∏è</button>
          </div>`;
        container.appendChild(div);
      }
    }

    function addSubject() {
      const name = prompt("Enter new subject name:");
      if (!name) return;
      const data = getUserData();
      if (data.subjects[name]) return alert("Subject already exists!");
      data.subjects[name] = [];
      updateUserData(data);
      loadSubjects();
    }

    function renameSubject(oldName) {
      const newName = prompt("Enter new subject name:");
      if (!newName) return;
      const data = getUserData();
      data.subjects[newName] = data.subjects[oldName];
      delete data.subjects[oldName];
      updateUserData(data);
      loadSubjects();
    }

    function deleteSubject(name) {
      const data = getUserData();
      delete data.subjects[name];
      updateUserData(data);
      loadSubjects();
    }

    function enterSubject(name) {
      currentSubject = name;
      document.getElementById("main").classList.add("hidden");
      document.getElementById("subjectView").classList.remove("hidden");
      document.getElementById("subjectTitle").innerText = name;
      loadFlashcards();
    }

    function goBack() {
      currentSubject = null;
      document.getElementById("subjectView").classList.add("hidden");
      document.getElementById("main").classList.remove("hidden");
    }

    function loadFlashcards() {
      const data = getUserData();
      const list = document.getElementById("flashcardList");
      list.innerHTML = "";
      for (let [i, card] of data.subjects[currentSubject].entries()) {
        const div = document.createElement("div");
        div.className = "flashcard";
        div.style.background = getUniqueColor();
        div.innerHTML = `
          <span>${card}</span>
          <div class="flashcard-btns">
            <button class="icon-btn" onclick="renameFlashcard(${i})">üñäÔ∏è</button>
            <button class="icon-btn" onclick="deleteFlashcard(${i})">‚úñÔ∏è</button>
          </div>`;
        list.appendChild(div);
      }
    }

    function addFlashcard() {
      const content = prompt("Enter flashcard content:");
      if (!content) return;
      const data = getUserData();
      data.subjects[currentSubject].push(content);
      updateUserData(data);
      loadFlashcards();
    }

    function renameFlashcard(index) {
      const content = prompt("Update flashcard content:");
      if (!content) return;
      const data = getUserData();
      data.subjects[currentSubject][index] = content;
      updateUserData(data);
      loadFlashcards();
    }

    function deleteFlashcard(index) {
      const data = getUserData();
      data.subjects[currentSubject].splice(index, 1);
      updateUserData(data);
      loadFlashcards();
    }

    function shuffleFlashcards() {
      const data = getUserData();
      for (let i = data.subjects[currentSubject].length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [data.subjects[currentSubject][i], data.subjects[currentSubject][j]] =
          [data.subjects[currentSubject][j], data.subjects[currentSubject][i]];
      }
      updateUserData(data);
      loadFlashcards();
    }
  </script>
</body>
</html>
