<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flashcard App with Colors & Shuffle</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 700px; margin: auto; background: #f7f7f7; }
  h1 { font-size: 24px; }
  .hidden { display: none; }
  /* --- Signup/Login --- */
  #login-signup-container {
    margin-bottom: 30px;
    background: white;
    padding: 20px;
    border-radius: 8px;
  }
  #color-options {
    display: flex;
    gap: 8px;
    margin-top: 10px;
  }
  .color-option {
    width: 30px; height: 30px; border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s;
  }
  .color-option.selected {
    border-color: #333;
  }
  /* --- Subjects --- */
  #subjects-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
  }
  .subject-card {
    position: relative;
    width: 120px;
    height: 120px;
    border-radius: 12px;
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 2px 5px rgb(0 0 0 / 0.2);
  }
  .subject-name {
    font-weight: bold;
    margin-bottom: 10px;
    text-align: center;
  }
  .subject-actions {
    position: absolute;
    bottom: 8px;
    display: flex;
    gap: 10px;
  }
  .subject-actions button {
    background: rgba(255 255 255 / 0.7);
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    padding: 2px 8px;
  }
  /* --- Flashcards view --- */
  #flashcards-view {
    margin-top: 20px;
    background: white;
    border-radius: 8px;
    padding: 15px;
  }
  #flashcards-list {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }
  .flashcard {
    padding: 15px;
    border-radius: 10px;
    color: white;
    width: 140px;
    min-height: 90px;
    position: relative;
    box-shadow: 0 3px 6px rgb(0 0 0 / 0.15);
    cursor: default;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .flashcard-actions {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
  }
  .flashcard-actions button {
    background: rgba(255 255 255 / 0.8);
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    padding: 2px 6px;
  }
  #flashcards-controls {
    margin-bottom: 10px;
  }
  #flashcards-controls button {
    margin-right: 8px;
    padding: 6px 12px;
    font-size: 14px;
    cursor: pointer;
    border-radius: 5px;
    border: none;
    background: #007bff;
    color: white;
  }
</style>
</head>
<body>

<div id="login-signup-container">
  <h1>Login / Signup</h1>
  <input type="text" id="username-input" placeholder="Enter username" />
  <div>
    <label>Pick flashcard color/design:</label>
    <div id="color-options">
      <!-- Color options will be inserted here -->
    </div>
  </div>
  <button id="login-btn">Login / Signup</button>
</div>

<div id="app-container" class="hidden">
  <button id="logout-btn">Logout</button>

  <h2>Your Subjects</h2>
  <div id="subjects-container"></div>
  <button id="add-subject-btn">Add Subject</button>

  <div id="flashcards-view" class="hidden">
    <button id="back-to-subjects-btn">‚Üê Back to Subjects</button>
    <h3 id="current-subject-title"></h3>
    <div id="flashcards-controls">
      <button id="add-flashcard-btn">Add Flashcard</button>
      <button id="shuffle-flashcards-btn">Shuffle Flashcards</button>
    </div>
    <div id="flashcards-list"></div>
  </div>
</div>

<script>
  // Colors for subjects and flashcards, wider palette for variety
  const subjectColors = ['#e63946', '#f1faee', '#a8dadc', '#457b9d', '#1d3557', '#ffb703', '#fb8500', '#219ebc', '#8ecae6', '#ff006e'];
  const flashcardColors = ['#ff6f91', '#ff9671', '#ffc75f', '#f9f871', '#a9def9', '#e4c1f9', '#b5ead7', '#ffcad4', '#f4acb7', '#cdb4db'];

  // Store users and data in memory for this demo
  let usersDB = {};
  let currentUser = null;
  let currentSubjectId = null;

  // Selected color at signup/login
  let selectedSignupColor = subjectColors[0];

  // Utilities to get a color that doesn't repeat consecutively
  function getNonRepeatingColor(usedColors, colorPool) {
    const available = colorPool.filter(c => !usedColors.includes(c));
    if (available.length === 0) return colorPool[Math.floor(Math.random() * colorPool.length)];
    return available[Math.floor(Math.random() * available.length)];
  }

  // --- Signup/login color options setup ---
  const colorOptionsContainer = document.getElementById('color-options');
  subjectColors.forEach(color => {
    const div = document.createElement('div');
    div.className = 'color-option';
    div.style.backgroundColor = color;
    if (color === selectedSignupColor) div.classList.add('selected');
    div.addEventListener('click', () => {
      selectedSignupColor = color;
      document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
      div.classList.add('selected');
    });
    colorOptionsContainer.appendChild(div);
  });

  // --- Login/signup ---
  document.getElementById('login-btn').addEventListener('click', () => {
    const username = document.getElementById('username-input').value.trim();
    if (!username) {
      alert('Please enter a username');
      return;
    }
    if (!usersDB[username]) {
      // New user: create with default subject and selected color
      usersDB[username] = {
        subjects: [{
          name: 'Welcome Subject',
          color: selectedSignupColor,
          flashcards: []
        }]
      };
    }
    currentUser = username;
    document.getElementById('login-signup-container').classList.add('hidden');
    document.getElementById('app-container').classList.remove('hidden');
    renderSubjects();
  });

  // --- Render subjects ---
  function renderSubjects() {
    currentSubjectId = null;
    document.getElementById('flashcards-view').classList.add('hidden');
    document.getElementById('subjects-container').innerHTML = '';

    const subjects = usersDB[currentUser].subjects;

    subjects.forEach((subject, idx) => {
      const card = document.createElement('div');
      card.className = 'subject-card';
      card.style.backgroundColor = subject.color;
      card.dataset.index = idx;

      const nameDiv = document.createElement('div');
      nameDiv.className = 'subject-name';
      nameDiv.textContent = subject.name;

      // Actions container with Rename and Delete buttons only
      const actionsDiv = document.createElement('div');
      actionsDiv.className = 'subject-actions';

      // Rename button
      const renameBtn = document.createElement('button');
      renameBtn.textContent = 'Rename';
      renameBtn.title = 'Rename Subject';
      renameBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const newName = prompt('Enter new subject name:', subject.name);
        if (newName && newName.trim() !== '') {
          subject.name = newName.trim();
          renderSubjects();
        }
      });

      // Delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.title = 'Delete Subject';
      deleteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (confirm('Are you sure you want to delete this subject?')) {
          usersDB[currentUser].subjects.splice(idx, 1);
          renderSubjects();
        }
      });

      actionsDiv.appendChild(renameBtn);
      actionsDiv.appendChild(deleteBtn);

      card.appendChild(nameDiv);
      card.appendChild(actionsDiv);

      // Click on subject to open flashcards view
      card.addEventListener('click', () => {
        openFlashcards(idx);
      });

      document.getElementById('subjects-container').appendChild(card);
    });
  }

  // --- Flashcards view ---
  const flashcardsView = document.getElementById('flashcards-view');
  const flashcardsList = document.getElementById('flashcards-list');
  const currentSubjectTitle = document.getElementById('current-subject-title');

  function openFlashcards(subjectId) {
    currentSubjectId = subjectId;
    const subject = usersDB[currentUser].subjects[subjectId];
    currentSubjectTitle.textContent = subject.name;
    flashcardsView.classList.remove('hidden');
    document.getElementById('subjects-container').innerHTML = '';
    document.getElementById('add-subject-btn').style.display = 'none';

    renderFlashcards();
  }

  function renderFlashcards() {
    flashcardsList.innerHTML = '';
    const flashcards = usersDB[currentUser].subjects[currentSubjectId].flashcards;

    flashcards.forEach((card, i) => {
      const div = document.createElement('div');
      div.className = 'flashcard';
      div.style.backgroundColor = card.color;

      div.innerHTML = `
        <div class="flashcard-content">${card.content}</div>
        <div class="flashcard-actions">
          <button data-action="edit" data-index="${i}">‚úèÔ∏è</button>
          <button data-action="delete" data-index="${i}">üóëÔ∏è</button>
        </div>
      `;

      // Actions handlers
      div.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          const action = btn.getAttribute('data-action');
          const index = parseInt(btn.getAttribute('data-index'));
          if (action === 'edit') {
            const newContent = prompt('Edit flashcard content:', flashcards[index].content);
            if (newContent && newContent.trim() !== '') {
              flashcards[index].content = newContent.trim();
              renderFlashcards();
            }
          } else if (action === 'delete') {
            if (confirm('Delete this flashcard?')) {
              flashcards.splice(index, 1);
              renderFlashcards();
            }
          }
        });
      });

      flashcardsList.appendChild(div);
    });
  }

  // --- Add Subject ---
  document.getElementById('add-subject-btn').addEventListener('click', () => {
    const newName = prompt('Enter new subject name:');
    if (newName && newName.trim() !== '') {
      // Get used colors to avoid repetition
      const usedColors = usersDB[currentUser].subjects.map(s => s.color);
      const newColor = getNonRepeatingColor(usedColors, subjectColors);
      usersDB[currentUser].subjects.push({
        name: newName.trim(),
        color: newColor,
        flashcards: []
      });
      renderSubjects();
    }
  });

  // --- Add Flashcard ---
  document.getElementById('add-flashcard-btn').addEventListener('click', () => {
    if (currentSubjectId === null) return;
    const content = prompt('Enter flashcard content:');
    if (content && content.trim() !== '') {
      const subject = usersDB[currentUser].subjects[currentSubjectId];
      // Avoid repeating colors in flashcards inside this subject
      const usedColors = subject.flashcards.map(fc => fc.color);
      const newColor = getNonRepeatingColor(usedColors, flashcardColors);
      subject.flashcards.push({
        content: content.trim(),
        color: newColor
      });
      renderFlashcards();
    }
  });

  // --- Shuffle Flashcards ---
  document.getElementById('shuffle-flashcards-btn').addEventListener('click', () => {
    if (currentSubjectId === null) return;
    const flashcards = usersDB[currentUser].subjects[currentSubjectId].flashcards;
    // Simple Fisher-Yates shuffle
    for (let i = flashcards.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [flashcards[i], flashcards[j]] = [flashcards[j], flashcards[i]];
    }
    renderFlashcards();
  });

  // --- Back to subjects ---
  document.getElementById('back-to-subjects-btn').addEventListener('click', () => {
    currentSubjectId = null;
    document.getElementById('flashcards-view').classList.add('hidden');
    document.getElementById('add-subject-btn').style.display = 'inline-block';
    renderSubjects();
  });

  // --- Logout ---
  document.getElementById('logout-btn').addEventListener('click', () => {
    if (confirm('Logout? Unsaved data will be lost.')) {
      currentUser = null;
      currentSubjectId = null;
      document.getElementById('app-container').classList.add('hidden');
      document.getElementById('login-signup-container').classList.remove('hidden');
      document.getElementById('username-input').value = '';
    }
  });
</script>

</body>
</html>
